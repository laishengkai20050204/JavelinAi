server:
  port: 8080
  http2:
    enabled: true

ai:
  mode: OPENAI        # switch to OLLAMA for local models
  model: ${AI_DEFAULT_MODEL:qwen3:8b}  # optional legacy override, defaults handled in code
  stepjson:
    heartbeat-seconds: 5       # NDJSON heartbeat interval (seconds)
  think:
    enabled: true               # enable optional thinking mode
#    level: medium               # optional: send low/medium/high when the upstream supports it
  tools:
    max-loops: 100
    dedup:
      enabled: true
      default-ttl-seconds: 600
      ignore-args: ["timestamp","requestId","nonce"]
    callStep:
      ttl-minutes: 30
      maximum-size: 10000
    web-search: # ← 这里也从 web_search 改成 web-search
      provider: serper
      serper:
        base-url: https://google.serper.dev   # 建议也用 kebab-case
        api-key: ${SERPER_API_KEY}
        timeout: 8s
      defaults:
        top-k: 5
        lang: zh-CN
        country: jp
        safe: true
    web-fetch:
      allowed-schemes: [ http, https ]
      timeout: 8s
      max-in-memory-bytes: 524288   # 512KB
      default-max-chars: 2000
      user-agent: JavelinAI-WebFetch/1.0
      ssrf-guard-enabled: false
    python:
      enabled: true
      use-docker: true
      docker-image: "javelin-py:v1"
      # —— 每用户一容器
      per-user-container: true
      # —— 工作区根目录（宿主机路径）
      workspace-root: "/var/javelin/workspaces/pyexec"
      # —— 容器安全与资源
      docker:
        user: "65534:65534"      # nobody
        read-only-root: true
        cpus: "2.0"
        memory: "2g"
        extra-create-args: >
          --pids-limit 256
          --tmpfs /tmp
          --tmpfs /var/tmp
          --security-opt no-new-privileges
          --add-host=host.docker.internal:host-gateway
      # —— 网络策略
      deny-network-after-setup: false  # 装完依赖后自动断网
      # —— 容器空闲回收
      idle-ttl-minutes: 60
      # —— 允许 pip（在容器内执行；若禁网，会临时接入网络）
      allow-pip: true
  memory:
    storage: database        # set to in-memory to use the in-memory implementation
    max-messages: 100
    persistenceMode: draft-and-final   # draft-and-final | final-only
    promoteDraftsOnFinish: true        # promote step DRAFT rows to FINAL when finished
  client:
    timeout-ms: 180000           # wait longer for upstream completion calls
    stream-timeout-ms: 240000    # longer window for streaming responses
    retry:
      max-attempts: 3
      backoff-ms: 500
  debug:
    log-raw-response: true
    include-raw-in-gateway-json: true
  multi:
    primary-model: gpt-reasoner
    models:
      glm-agent:
        provider: glm-openai
        base-url: https://dashscope.aliyuncs.com
        api-key: ${GLM_API_KEY}
        model-id: glm-4.6
        temperature: 0.3
        tool-context-render-mode: CURRENT_TOOL_HISTORY_SUMMARY
      gpt-reasoner:
        provider: openai
        base-url: https://api.vveai.com
        api-key: ${OPENAI_API_KEY}
        model-id: gpt-5-high
        temperature: 0.2
        tool-context-render-mode: ALL_TOOL
      gemini-vision:
        provider: gemini
        base-url: https://api.vveai.com
        api-key: ${GEMINI_API_KEY}
        model-id: gemini-1.5-pro
        tool-context-render-mode: ALL_SUMMARY



spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY:dummy}
      # Spring AI appends the /v1/* paths automatically; point at the root host.
      base-url: ${OPENAI_BASE_URL:http://localhost:11434}
      chat:
        options:
          model: ${AI_OPENAI_MODEL:qwen3:8b}
          temperature: 0.2
    ollama:
      base-url: ${OLLAMA_BASE_URL:http://localhost:11434}
      chat:
        options:
          model: ${AI_OLLAMA_MODEL:qwen3:8b}
          temperature: 0.2
  main:
    web-application-type: reactive

  datasource:
    url: jdbc:mysql://localhost:3306/java_ai?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    username: root
    password: 123
    driver-class-name: com.mysql.cj.jdbc.Driver
springdoc:
  swagger-ui:
    path: /swagger-ui

logging:
  level:
    com.example: DEBUG

mybatis:
  mapper-locations: classpath*:com/example/mapper/*.xml

sse:
  heartbeat-every: PT20S   # 20 秒心跳
  step-ttl: PT10M          # 10 分钟无活动自动清理
  janitor-every: PT60S     # 60 秒扫一次

storage:
  minio:
    endpoint: http://127.0.0.1:9000   # 你容器对宿主机暴露的地址
    accessKey: admin             # 改成你的 MINIO_ROOT_USER
    secretKey: Lsk20050204             # 改成你的 MINIO_ROOT_PASSWORD
    region: us-east-1                 # 保持默认即可
    secure: false                     # http=false / https=true
    defaultBucket: javelin-exec        # 建议预设一个默认桶
    presignExpirySeconds: 3600        # 预签名URL有效期（秒）